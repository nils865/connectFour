var _e=Object.defineProperty;var ye=(n,e,t)=>e in n?_e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>(ye(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(l){if(l.ep)return;l.ep=!0;const s=t(l);fetch(l.href,s)}})();function y(){}function re(n){return n()}function J(){return Object.create(null)}function A(n){n.forEach(re)}function ce(n){return typeof n=="function"}function Y(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let B;function Ce(n,e){return B||(B=document.createElement("a")),B.href=e,n===B.href}function we(n){return Object.keys(n).length===0}function be(n,...e){if(n==null)return y;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function E(n,e,t){n.$$.on_destroy.push(be(e,t))}function Q(n,e,t){return n.set(t),e}function g(n,e){n.appendChild(e)}function j(n,e,t){n.insertBefore(e,t||null)}function W(n){n.parentNode&&n.parentNode.removeChild(n)}function de(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function p(n){return document.createElement(n)}function ve(n){return document.createTextNode(n)}function N(){return ve(" ")}function D(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function u(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Se(n){return Array.from(n.childNodes)}function U(n,e){for(let t=0;t<n.options.length;t+=1){const i=n.options[t];if(i.__value===e){i.selected=!0;return}}n.selectedIndex=-1}function Le(n){const e=n.querySelector(":checked")||n.options[0];return e&&e.__value}let K;function I(n){K=n}const S=[],X=[],F=[],Z=[],$e=Promise.resolve();let R=!1;function xe(){R||(R=!0,$e.then(ae))}function M(n){F.push(n)}const H=new Set;let b=0;function ae(){if(b!==0)return;const n=K;do{try{for(;b<S.length;){const e=S[b];b++,I(e),ke(e.$$)}}catch(e){throw S.length=0,b=0,e}for(I(null),S.length=0,b=0;X.length;)X.pop()();for(let e=0;e<F.length;e+=1){const t=F[e];H.has(t)||(H.add(t),t())}F.length=0}while(S.length);for(;Z.length;)Z.pop()();R=!1,H.clear(),I(n)}function ke(n){if(n.fragment!==null){n.update(),A(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(M)}}const q=new Set;let Ee;function ue(n,e){n&&n.i&&(q.delete(n),n.i(e))}function Ie(n,e,t,i){if(n&&n.o){if(q.has(n))return;q.add(n),Ee.c.push(()=>{q.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function Ae(n){n&&n.c()}function fe(n,e,t,i){const{fragment:l,after_update:s}=n.$$;l&&l.m(e,t),i||M(()=>{const o=n.$$.on_mount.map(re).filter(ce);n.$$.on_destroy?n.$$.on_destroy.push(...o):A(o),n.$$.on_mount=[]}),s.forEach(M)}function he(n,e){const t=n.$$;t.fragment!==null&&(A(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function We(n,e){n.$$.dirty[0]===-1&&(S.push(n),xe(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function me(n,e,t,i,l,s,o,c=[-1]){const d=K;I(n);const r=n.$$={fragment:null,ctx:[],props:s,update:y,not_equal:l,bound:J(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:J(),dirty:c,skip_bound:!1,root:e.target||d.$$.root};o&&o(r.root);let a=!1;if(r.ctx=t?t(n,e.props||{},(f,C,...k)=>{const h=k.length?k[0]:C;return r.ctx&&l(r.ctx[f],r.ctx[f]=h)&&(!r.skip_bound&&r.bound[f]&&r.bound[f](h),a&&We(n,f)),C}):[],r.update(),a=!0,A(r.before_update),r.fragment=i?i(r.ctx):!1,e.target){if(e.hydrate){const f=Se(e.target);r.fragment&&r.fragment.l(f),f.forEach(W)}else r.fragment&&r.fragment.c();e.intro&&ue(n.$$.fragment),fe(n,e.target,e.anchor,e.customElement),ae()}I(d)}class ge{$destroy(){he(this,1),this.$destroy=y}$on(e,t){if(!ce(t))return y;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!we(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const v=[];function O(n,e=y){let t;const i=new Set;function l(c){if(Y(n,c)&&(n=c,t)){const d=!v.length;for(const r of i)r[1](),v.push(r,n);if(d){for(let r=0;r<v.length;r+=2)v[r][0](v[r+1]);v.length=0}}}function s(c){l(c(n))}function o(c,d=y){const r=[c,d];return i.add(r),i.size===1&&(t=e(l)||y),c(n),()=>{i.delete(r),i.size===0&&(t(),t=null)}}return{set:l,update:s,subscribe:o}}const L=O(`It's <span style="color: red">reds</span> turn`),V=O(!1),$=O("redCoin"),T=O("twoPlayer"),_=7,x=6;function pe(){const n=document.createElement("div");for(let t=0;t<_;t++){const i=document.createElement("div");i.classList.add("column"),i.id=`column${t}`,n.appendChild(i)}const e=document.getElementsByClassName("column");for(let t=0;t<e.length;t++)for(let i=0;i<e[t].children.length;i++){const l=document.createElement("div");l.classList.add("slot");const s=document.createElement("div");w(e[t].children[i])!=null&&s.classList.add("coin",`${w(e[t].children[i])}`),l.appendChild(s),n.children[t].appendChild(l)}return n.children}function Be(n){const e=document.getElementsByClassName("column");for(let t=0;t<e.length;t++){const i=e[t].children;for(let l=0;l<i.length;l++){const s=i[l].children[0];n(s)}}}function De(){let n=null;$.subscribe(e=>n=e),n==="redCoin"?$.set("yellowCoin"):$.set("redCoin")}function ee(){V.set(!1),$.set("redCoin"),L.set(`It's <span style="color: red">reds</span> turn`),console.clear(),Be(n=>{n.classList.remove("coin"),n.classList.remove("blink"),n.classList.contains("redCoin")?n.classList.remove("redCoin"):n.classList.contains("yellowCoin")&&n.classList.remove("yellowCoin")})}function w(n){return n.children[0].classList.contains("redCoin")?"redCoin":n.children[0].classList.contains("yellowCoin")?"yellowCoin":null}function z(n){const e=n.children;for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.children[0].classList.contains("coin"))continue;let l=null;$.subscribe(o=>l=o),i.children[0].classList.add(l),i.children[0].classList.add("coin");const s={children:e,index:t};return De(),s}}class te{constructor(){m(this,"field");this.field=document.createElement("div"),this.addColumns()}get Field(){return this.field.children}getSlot(e,t){if(t==="top"){for(let i=0;i<this.field.children[e].children.length;i++)if(this.field.children[e].children[i].children[0].classList.contains("coin")){t=i;break}}return{element:this.field.children[e].children[t],column:e,row:t}}showField(){const e=new Array(x).fill("");for(let t=0;t<_;t++){const i=this.field.children[t];for(let l=0;l<x;l++){let s=i.children[l].children[0].classList;s.contains("redCoin")?e[l]+="R ":s.contains("yellowCoin")?e[l]+="Y ":e[l]+=`${l} `}}console.log(`
---------------------------
`),e.forEach(t=>{console.log(t)})}edit(e,t,i){if(t==="top")for(let s=0;s<this.field.children[e].children.length;s++)this.field.children[e].children[s].children[0].classList.contains("coin")||(t=s);t=t==="top"?0:t;const l=this.field.children[e].children[t].children[0].classList;l.add(i),l.add("coin")}fill(e){for(let t=0;t<e.length;t++){const i=e[t];for(let l=0;l<i.children.length;l++){const s=i.children[l].children[0].classList;s.contains("redCoin")?(this.field.children[t].children[l].children[0].classList.add("coin"),this.field.children[t].children[l].children[0].classList.add("redCoin")):s.contains("yellowCoin")&&(this.field.children[t].children[l].children[0].classList.add("coin"),this.field.children[t].children[l].children[0].classList.add("yellowCoin"))}}}addColumns(){for(let e=0;e<_;e++){const t=document.createElement("div");t.classList.add("column"),t.id=`column${e}`,this.field.appendChild(t),this.addSlots(e)}}addSlots(e){for(let t=0;t<x;t++){const i=document.createElement("div");i.classList.add("slot"),i.appendChild(document.createElement("div")),this.field.children[e].appendChild(i)}}}function ne(n){const e=new G(n.children[n.index],pe()),t=e.WinState;return t.state&&(V.set(!0),e.addBlink(),t.winner==="redCoin"?L.set('<span style="color: red">Red</span> won!'):t.winner==="yellowCoin"&&L.set('<span style="color: yellow">Yellow</span> won!')),e.WinState}class G{constructor(e,t){m(this,"output");m(this,"lastCoin");m(this,"columns");m(this,"connectedElements");this.output={state:!1,elements:[],winner:null},this.lastCoin=new le(e),this.columns=t,this.connectedElements=[this.checkColumn(),this.checkRow(),this.checkDiagonal(i=>({x:i.x+1,y:i.y-1}),i=>({x:i.x-1,y:i.y+1})),this.checkDiagonal(i=>({x:i.x-1,y:i.y-1}),i=>({x:i.x+1,y:i.y+1}))],this.connectedElements.forEach(i=>{i.length>=4&&(this.output.state=!0,this.output.winner=this.lastCoin.State,i.forEach(l=>{this.output.elements.includes(l)||this.output.elements.push(l)}))})}addBlink(){this.output.elements.forEach(e=>{const t=new le(e);document.getElementsByClassName("column")[t.ColumnId].children[t.SlotId].children[0].classList.add("blink")})}get WinState(){return this.output}get ConnectedElements(){return this.connectedElements}checkColumn(){let e=[];for(let t=this.lastCoin.SlotId;t<x&&this.lastCoin.State==w(this.columns[this.lastCoin.ColumnId].children[t]);t++)e.push(this.getSlot({x:this.lastCoin.ColumnId,y:t}));return e}checkRow(){let e=[],t=-1;for(let i=this.lastCoin.ColumnId;i>=0&&t<0;i--)this.lastCoin.State!=w(this.getSlot({x:i,y:this.lastCoin.SlotId}))&&(t=i);t++;for(let i=t;i<_&&this.lastCoin.State===w(this.getSlot({x:i,y:this.lastCoin.SlotId}));i++)e.push(this.getSlot({x:i,y:this.lastCoin.SlotId}));return e}checkDiagonal(e,t){let i=[];const l={x:this.lastCoin.ColumnId,y:this.lastCoin.SlotId};let s=e(l);for(;ie(t(s))&&w(this.getSlot(t(s)))===this.lastCoin.State;)s=t(s);let o=t(s);for(;ie(e(o))&&w(this.getSlot(e(o)))==this.lastCoin.State;)o=e(o),i.push(this.getSlot(o));return i}getSlot(e){return this.columns[e.x].children[e.y]}}const ie=n=>n.x<_&&n.x>=0&&n.y<x&&n.y>=0;class le{constructor(e){m(this,"element");m(this,"slotId");m(this,"columnId");m(this,"state");this.element=e,this.columnId=parseInt(this.element.parentElement.id[this.element.parentElement.id.length-1]),this.calcSlotId(),this.calcState()}get Element(){return this.element}get SlotId(){return this.slotId}get ColumnId(){return this.columnId}get State(){return this.state}calcSlotId(){const e=this.element.parentElement;for(let t=0;t<e.children.length;t++)if(e.children[t]==this.element){this.slotId=t;break}}calcState(){this.element.children[0].classList.contains("yellowCoin")?this.state="yellowCoin":this.element.children[0].classList.contains("redCoin")?this.state="redCoin":this.state=null}}class Fe{constructor(){m(this,"columns");this.columns=document.getElementsByClassName("column")}spawnCoin(){const e=this.checkForWin("yellowCoin");if(e!=null)return e;const t=this.checkForWin("redCoin");if(t!=null)return t;const i=this.generateBestPos();if(i>=0){const l=z(this.columns[i]);return l===void 0?this.spawnCoin():l}}generateBestPos(){const e=Array.from({length:_},()=>({field:new te,id:0})).filter((l,s)=>(l.id=s,l.field.fill(document.getElementsByClassName("column")),l.field.edit(s,"top","yellowCoin"),new G(l.field.getSlot(s,"top").element,l.field.Field).WinState.state?null:l));let t=Array.from({length:e.length},()=>({move:null,children:[]})).filter((l,s)=>(l.move=e[s].field,l.id=e[s].id,l.children=Array.from({length:_},()=>new te),l.children=l.children.filter((o,c)=>(o.fill(l.move.Field),o.edit(c,"top","redCoin"),new G(o.getSlot(c,"top").element,o.Field).WinState.state?null:o)),l.children.length<_?null:l));return t[Math.floor(Math.random()*t.length)].id}checkForWin(e){for(let t=0;t<_;t++){const i=this.generateGamefield(pe(),t,e);if(i===null)continue;if(new G(i.slot,i.field).WinState.state)return z(this.columns[t])}return null}generateGamefield(e,t,i){let l=-1;for(let s=0;s<e[t].children.length;s++)e[t].children[s].children[0].classList.contains("coin")||(l=s);return l<=-1?null:(e[t].children[l].children[0].classList.add("coin",`${i}`),{slot:e[t].children[l],field:e})}}function se(n,e,t){const i=n.slice();return i[6]=e[t],i[8]=t,i}function qe(n,e,t){const i=n.slice();return i[6]=e[t],i}function Ge(n){let e;return{c(){e=p("div"),e.innerHTML="<div></div>",u(e,"class","slot svelte-1g2txc2")},m(t,i){j(t,e,i)},p:y,d(t){t&&W(e)}}}function oe(n){let e,t,i,l,s=Array(x),o=[];for(let c=0;c<s.length;c+=1)o[c]=Ge(qe(n,s,c));return{c(){e=p("div");for(let c=0;c<o.length;c+=1)o[c].c();t=N(),u(e,"id","column"+n[8]),u(e,"class","column svelte-1g2txc2")},m(c,d){j(c,e,d);for(let r=0;r<o.length;r+=1)o[r].m(e,null);g(e,t),i||(l=D(e,"click",n[1]),i=!0)},p:y,d(c){c&&W(e),de(o,c),i=!1,l()}}}function Ne(n){let e,t,i,l,s=Array(_),o=[];for(let c=0;c<s.length;c+=1)o[c]=oe(se(n,s,c));return{c(){e=p("div"),t=p("h1"),i=N(),l=p("div");for(let c=0;c<o.length;c+=1)o[c].c();u(t,"class","svelte-1g2txc2"),u(l,"id","gamefield"),u(l,"class","svelte-1g2txc2")},m(c,d){j(c,e,d),g(e,t),t.innerHTML=n[0],g(e,i),g(e,l);for(let r=0;r<o.length;r+=1)o[r].m(l,null)},p(c,[d]){if(d&1&&(t.innerHTML=c[0]),d&2){s=Array(_);let r;for(r=0;r<s.length;r+=1){const a=se(c,s,r);o[r]?o[r].p(a,d):(o[r]=oe(a),o[r].c(),o[r].m(l,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}},i:y,o:y,d(c){c&&W(e),de(o,c)}}}function Me(n,e,t){let i,l,s,o;E(n,L,r=>t(0,i=r)),E(n,$,r=>t(2,l=r)),E(n,V,r=>t(3,s=r)),E(n,T,r=>t(4,o=r));const c=new Fe;function d(r){if(s)return;let a=r.target;if(a.classList.contains("coin")&&(a=a.parentElement),a.classList.contains("slot")&&(a=a.parentElement),a.classList.contains("column")&&a.id.startsWith("column")){const f=z(a);if(f==null)return;!ne(f).state&&o=="onePlayer"&&ne(c.spawnCoin())}else return;s||(l=="redCoin"?Q(L,i=`It's <span style="color: red">reds</span> turn`,i):l=="yellowCoin"&&Q(L,i=`It's <span style="color: yellow">yellows</span> turn`,i))}return[i,d]}class je extends ge{constructor(e){super(),me(this,e,Me,Ne,Y,{})}}function Oe(n){let e,t,i,l,s,o,c,d,r,a,f,C,k;return a=new je({}),{c(){e=p("div"),t=p("div"),i=p("img"),s=N(),o=p("select"),c=p("option"),c.textContent="2p",d=p("option"),d.textContent="1p",r=N(),Ae(a.$$.fragment),u(i,"id","refresh"),Ce(i.src,l="./img/refresh.svg")||u(i,"src",l),u(i,"alt","refresh"),u(i,"draggable","false"),u(i,"class","svelte-7lxkbq"),c.__value="twoPlayer",c.value=c.__value,d.__value="onePlayer",d.value=d.__value,u(o,"name","mode"),u(o,"id","mode"),u(o,"class","svelte-7lxkbq"),n[0]===void 0&&M(()=>n[3].call(o)),u(t,"id","globalHead"),u(t,"class","svelte-7lxkbq"),u(e,"id","mainPage"),u(e,"class","svelte-7lxkbq")},m(h,P){j(h,e,P),g(e,t),g(t,i),g(t,s),g(t,o),g(o,c),g(o,d),U(o,n[0]),g(e,r),fe(a,e,null),f=!0,C||(k=[D(i,"click",n[1]),D(o,"change",n[2]),D(o,"change",n[3])],C=!0)},p(h,[P]){P&1&&U(o,h[0])},i(h){f||(ue(a.$$.fragment,h),f=!0)},o(h){Ie(a.$$.fragment,h),f=!1},d(h){h&&W(e),he(a),C=!1,A(k)}}}function Pe(n,e,t){let i;E(n,T,c=>t(0,i=c));const l=()=>ee(),s=()=>ee();function o(){i=Le(this),T.set(i)}return[i,l,s,o]}class He extends ge{constructor(e){super(),me(this,e,Pe,Oe,Y,{})}}new He({target:document.getElementById("app")});
