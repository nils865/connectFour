var ye=Object.defineProperty;var Ce=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var g=(n,e,t)=>(Ce(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(l){if(l.ep)return;l.ep=!0;const s=t(l);fetch(l.href,s)}})();function y(){}function ce(n){return n()}function J(){return Object.create(null)}function A(n){n.forEach(ce)}function de(n){return typeof n=="function"}function Y(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let W;function we(n,e){return W||(W=document.createElement("a")),W.href=e,n===W.href}function be(n){return Object.keys(n).length===0}function ve(n,...e){if(n==null)return y;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function E(n,e,t){n.$$.on_destroy.push(ve(e,t))}function Q(n,e,t){return n.set(t),e}function p(n,e){n.appendChild(e)}function j(n,e,t){n.insertBefore(e,t||null)}function F(n){n.parentNode&&n.parentNode.removeChild(n)}function ae(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function _(n){return document.createElement(n)}function Se(n){return document.createTextNode(n)}function N(){return Se(" ")}function B(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function u(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Le(n){return Array.from(n.childNodes)}function U(n,e){for(let t=0;t<n.options.length;t+=1){const i=n.options[t];if(i.__value===e){i.selected=!0;return}}n.selectedIndex=-1}function $e(n){const e=n.querySelector(":checked")||n.options[0];return e&&e.__value}let K;function I(n){K=n}const S=[],X=[],D=[],Z=[],xe=Promise.resolve();let R=!1;function ke(){R||(R=!0,xe.then(ue))}function M(n){D.push(n)}const H=new Set;let b=0;function ue(){if(b!==0)return;const n=K;do{try{for(;b<S.length;){const e=S[b];b++,I(e),Ee(e.$$)}}catch(e){throw S.length=0,b=0,e}for(I(null),S.length=0,b=0;X.length;)X.pop()();for(let e=0;e<D.length;e+=1){const t=D[e];H.has(t)||(H.add(t),t())}D.length=0}while(S.length);for(;Z.length;)Z.pop()();R=!1,H.clear(),I(n)}function Ee(n){if(n.fragment!==null){n.update(),A(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(M)}}const q=new Set;let Ie;function fe(n,e){n&&n.i&&(q.delete(n),n.i(e))}function Ae(n,e,t,i){if(n&&n.o){if(q.has(n))return;q.add(n),Ie.c.push(()=>{q.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function Fe(n){n&&n.c()}function he(n,e,t,i){const{fragment:l,after_update:s}=n.$$;l&&l.m(e,t),i||M(()=>{const o=n.$$.on_mount.map(ce).filter(de);n.$$.on_destroy?n.$$.on_destroy.push(...o):A(o),n.$$.on_mount=[]}),s.forEach(M)}function me(n,e){const t=n.$$;t.fragment!==null&&(A(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function We(n,e){n.$$.dirty[0]===-1&&(S.push(n),ke(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ge(n,e,t,i,l,s,o,c=[-1]){const d=K;I(n);const r=n.$$={fragment:null,ctx:[],props:s,update:y,not_equal:l,bound:J(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:J(),dirty:c,skip_bound:!1,root:e.target||d.$$.root};o&&o(r.root);let a=!1;if(r.ctx=t?t(n,e.props||{},(f,C,...k)=>{const h=k.length?k[0]:C;return r.ctx&&l(r.ctx[f],r.ctx[f]=h)&&(!r.skip_bound&&r.bound[f]&&r.bound[f](h),a&&We(n,f)),C}):[],r.update(),a=!0,A(r.before_update),r.fragment=i?i(r.ctx):!1,e.target){if(e.hydrate){const f=Le(e.target);r.fragment&&r.fragment.l(f),f.forEach(F)}else r.fragment&&r.fragment.c();e.intro&&fe(n.$$.fragment),he(n,e.target,e.anchor,e.customElement),ue()}I(d)}class pe{$destroy(){me(this,1),this.$destroy=y}$on(e,t){if(!de(t))return y;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!be(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const v=[];function O(n,e=y){let t;const i=new Set;function l(c){if(Y(n,c)&&(n=c,t)){const d=!v.length;for(const r of i)r[1](),v.push(r,n);if(d){for(let r=0;r<v.length;r+=2)v[r][0](v[r+1]);v.length=0}}}function s(c){l(c(n))}function o(c,d=y){const r=[c,d];return i.add(r),i.size===1&&(t=e(l)||y),c(n),()=>{i.delete(r),i.size===0&&(t(),t=null)}}return{set:l,update:s,subscribe:o}}const L=O(`It's <span style="color: red">reds</span> turn`),V=O(!1),$=O("redCoin"),T=O("twoPlayer"),m=7,x=6;function _e(){const n=document.createElement("div");for(let t=0;t<m;t++){const i=document.createElement("div");i.classList.add("column"),i.id=`column${t}`,n.appendChild(i)}const e=document.getElementsByClassName("column");for(let t=0;t<e.length;t++)for(let i=0;i<e[t].children.length;i++){const l=document.createElement("div");l.classList.add("slot");const s=document.createElement("div");w(e[t].children[i])!=null&&s.classList.add("coin",`${w(e[t].children[i])}`),l.appendChild(s),n.children[t].appendChild(l)}return n.children}function Be(n){const e=document.getElementsByClassName("column");for(let t=0;t<e.length;t++){const i=e[t].children;for(let l=0;l<i.length;l++){const s=i[l].children[0];n(s)}}}function ee(n){return n.children[0].children[0].classList.contains("coin")}function De(){let n=null;$.subscribe(e=>n=e),n==="redCoin"?$.set("yellowCoin"):$.set("redCoin")}function te(){V.set(!1),$.set("redCoin"),L.set(`It's <span style="color: red">reds</span> turn`),console.clear(),Be(n=>{n.classList.remove("coin"),n.classList.remove("blink"),n.classList.contains("redCoin")?n.classList.remove("redCoin"):n.classList.contains("yellowCoin")&&n.classList.remove("yellowCoin")})}function w(n){return n.children[0].classList.contains("redCoin")?"redCoin":n.children[0].classList.contains("yellowCoin")?"yellowCoin":null}function z(n){const e=n.children;for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.children[0].classList.contains("coin"))continue;let l=null;$.subscribe(o=>l=o),i.children[0].classList.add(l),i.children[0].classList.add("coin");const s={children:e,index:t};return De(),s}}class ne{constructor(){g(this,"field");this.field=document.createElement("div"),this.addColumns()}get Field(){return this.field.children}getSlot(e,t){if(t==="top"){for(let i=0;i<this.field.children[e].children.length;i++)if(this.field.children[e].children[i].children[0].classList.contains("coin")){t=i;break}}return{element:this.field.children[e].children[t],column:e,row:t}}showField(){const e=new Array(x).fill("");for(let t=0;t<m;t++){const i=this.field.children[t];for(let l=0;l<x;l++){let s=i.children[l].children[0].classList;s.contains("redCoin")?e[l]+="R ":s.contains("yellowCoin")?e[l]+="Y ":e[l]+=`${l} `}}console.log(`
---------------------------
`),e.forEach(t=>{console.log(t)})}edit(e,t,i){if(t==="top")for(let s=0;s<this.field.children[e].children.length;s++)this.field.children[e].children[s].children[0].classList.contains("coin")||(t=s);t=t==="top"?0:t;const l=this.field.children[e].children[t].children[0].classList;l.add(i),l.add("coin")}fill(e){for(let t=0;t<e.length;t++){const i=e[t];for(let l=0;l<i.children.length;l++){const s=i.children[l].children[0].classList;s.contains("redCoin")?(this.field.children[t].children[l].children[0].classList.add("coin"),this.field.children[t].children[l].children[0].classList.add("redCoin")):s.contains("yellowCoin")&&(this.field.children[t].children[l].children[0].classList.add("coin"),this.field.children[t].children[l].children[0].classList.add("yellowCoin"))}}}addColumns(){for(let e=0;e<m;e++){const t=document.createElement("div");t.classList.add("column"),t.id=`column${e}`,this.field.appendChild(t),this.addSlots(e)}}addSlots(e){for(let t=0;t<x;t++){const i=document.createElement("div");i.classList.add("slot"),i.appendChild(document.createElement("div")),this.field.children[e].appendChild(i)}}}function ie(n){const e=new G(n.children[n.index],_e()),t=e.WinState;return t.state&&(V.set(!0),e.addBlink(),t.winner==="redCoin"?L.set('<span style="color: red">Red</span> won!'):t.winner==="yellowCoin"&&L.set('<span style="color: yellow">Yellow</span> won!')),e.WinState}class G{constructor(e,t){g(this,"output");g(this,"lastCoin");g(this,"columns");g(this,"connectedElements");this.output={state:!1,elements:[],winner:null},this.lastCoin=new se(e),this.columns=t,this.connectedElements=[this.checkColumn(),this.checkRow(),this.checkDiagonal(i=>({x:i.x+1,y:i.y-1}),i=>({x:i.x-1,y:i.y+1})),this.checkDiagonal(i=>({x:i.x-1,y:i.y-1}),i=>({x:i.x+1,y:i.y+1}))],this.connectedElements.forEach(i=>{i.length>=4&&(this.output.state=!0,this.output.winner=this.lastCoin.State,i.forEach(l=>{this.output.elements.includes(l)||this.output.elements.push(l)}))})}addBlink(){this.output.elements.forEach(e=>{const t=new se(e);document.getElementsByClassName("column")[t.ColumnId].children[t.SlotId].children[0].classList.add("blink")})}get WinState(){return this.output}get ConnectedElements(){return this.connectedElements}checkColumn(){let e=[];for(let t=this.lastCoin.SlotId;t<x&&this.lastCoin.State==w(this.columns[this.lastCoin.ColumnId].children[t]);t++)e.push(this.getSlot({x:this.lastCoin.ColumnId,y:t}));return e}checkRow(){let e=[],t=-1;for(let i=this.lastCoin.ColumnId;i>=0&&t<0;i--)this.lastCoin.State!=w(this.getSlot({x:i,y:this.lastCoin.SlotId}))&&(t=i);t++;for(let i=t;i<m&&this.lastCoin.State===w(this.getSlot({x:i,y:this.lastCoin.SlotId}));i++)e.push(this.getSlot({x:i,y:this.lastCoin.SlotId}));return e}checkDiagonal(e,t){let i=[];const l={x:this.lastCoin.ColumnId,y:this.lastCoin.SlotId};let s=e(l);for(;le(t(s))&&w(this.getSlot(t(s)))===this.lastCoin.State;)s=t(s);let o=t(s);for(;le(e(o))&&w(this.getSlot(e(o)))==this.lastCoin.State;)o=e(o),i.push(this.getSlot(o));return i}getSlot(e){return this.columns[e.x].children[e.y]}}const le=n=>n.x<m&&n.x>=0&&n.y<x&&n.y>=0;class se{constructor(e){g(this,"element");g(this,"slotId");g(this,"columnId");g(this,"state");this.element=e,this.columnId=parseInt(this.element.parentElement.id[this.element.parentElement.id.length-1]),this.calcSlotId(),this.calcState()}get Element(){return this.element}get SlotId(){return this.slotId}get ColumnId(){return this.columnId}get State(){return this.state}calcSlotId(){const e=this.element.parentElement;for(let t=0;t<e.children.length;t++)if(e.children[t]==this.element){this.slotId=t;break}}calcState(){this.element.children[0].classList.contains("yellowCoin")?this.state="yellowCoin":this.element.children[0].classList.contains("redCoin")?this.state="redCoin":this.state=null}}class qe{constructor(){g(this,"columns");this.columns=document.getElementsByClassName("column")}spawnCoin(){const e=this.checkForWin("yellowCoin");if(e!=null)return e;const t=this.checkForWin("redCoin");if(t!=null)return t;const i=this.generateBestPos();if(i>=0){const l=z(this.columns[i]);return l===void 0?this.spawnCoin():l}}generateBestPos(){const e=Array.from({length:m},()=>({field:new ne,id:0})).filter((l,s)=>ee(this.columns[s])||(l.id=s,l.field.fill(document.getElementsByClassName("column")),l.field.edit(s,"top","yellowCoin"),new G(l.field.getSlot(s,"top").element,l.field.Field).WinState.state)?null:l);let t=Array.from({length:e.length},()=>({move:null,children:[]})).filter((l,s)=>{if(l.move=e[s].field,l.id=e[s].id,l.children=Array.from({length:m},()=>new ne),l.children=l.children.filter((o,c)=>(o.fill(l.move.Field),o.edit(c,"top","redCoin"),new G(o.getSlot(c,"top").element,o.Field).WinState.state?null:o)),console.log(l.children.length),l.children.length<=0){for(let o=0;o<m;o++)if(!ee(this.columns[o]))return o}return l.children.length<m?null:l});return t[Math.floor(Math.random()*t.length)].id}checkForWin(e){for(let t=0;t<m;t++){const i=this.generateGamefield(_e(),t,e);if(i===null)continue;if(new G(i.slot,i.field).WinState.state)return z(this.columns[t])}return null}generateGamefield(e,t,i){let l=-1;for(let s=0;s<e[t].children.length;s++)e[t].children[s].children[0].classList.contains("coin")||(l=s);return l<=-1?null:(e[t].children[l].children[0].classList.add("coin",`${i}`),{slot:e[t].children[l],field:e})}}function oe(n,e,t){const i=n.slice();return i[6]=e[t],i[8]=t,i}function Ge(n,e,t){const i=n.slice();return i[6]=e[t],i}function Ne(n){let e;return{c(){e=_("div"),e.innerHTML="<div></div>",u(e,"class","slot svelte-1g2txc2")},m(t,i){j(t,e,i)},p:y,d(t){t&&F(e)}}}function re(n){let e,t,i,l,s=Array(x),o=[];for(let c=0;c<s.length;c+=1)o[c]=Ne(Ge(n,s,c));return{c(){e=_("div");for(let c=0;c<o.length;c+=1)o[c].c();t=N(),u(e,"id","column"+n[8]),u(e,"class","column svelte-1g2txc2")},m(c,d){j(c,e,d);for(let r=0;r<o.length;r+=1)o[r].m(e,null);p(e,t),i||(l=B(e,"click",n[1]),i=!0)},p:y,d(c){c&&F(e),ae(o,c),i=!1,l()}}}function Me(n){let e,t,i,l,s=Array(m),o=[];for(let c=0;c<s.length;c+=1)o[c]=re(oe(n,s,c));return{c(){e=_("div"),t=_("h1"),i=N(),l=_("div");for(let c=0;c<o.length;c+=1)o[c].c();u(t,"class","svelte-1g2txc2"),u(l,"id","gamefield"),u(l,"class","svelte-1g2txc2")},m(c,d){j(c,e,d),p(e,t),t.innerHTML=n[0],p(e,i),p(e,l);for(let r=0;r<o.length;r+=1)o[r].m(l,null)},p(c,[d]){if(d&1&&(t.innerHTML=c[0]),d&2){s=Array(m);let r;for(r=0;r<s.length;r+=1){const a=oe(c,s,r);o[r]?o[r].p(a,d):(o[r]=re(a),o[r].c(),o[r].m(l,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}},i:y,o:y,d(c){c&&F(e),ae(o,c)}}}function je(n,e,t){let i,l,s,o;E(n,L,r=>t(0,i=r)),E(n,$,r=>t(2,l=r)),E(n,V,r=>t(3,s=r)),E(n,T,r=>t(4,o=r));const c=new qe;function d(r){if(s)return;let a=r.target;if(a.classList.contains("coin")&&(a=a.parentElement),a.classList.contains("slot")&&(a=a.parentElement),a.classList.contains("column")&&a.id.startsWith("column")){const f=z(a);if(f==null)return;!ie(f).state&&o=="onePlayer"&&ie(c.spawnCoin())}else return;s||(l=="redCoin"?Q(L,i=`It's <span style="color: red">reds</span> turn`,i):l=="yellowCoin"&&Q(L,i=`It's <span style="color: yellow">yellows</span> turn`,i))}return[i,d]}class Oe extends pe{constructor(e){super(),ge(this,e,je,Me,Y,{})}}function Pe(n){let e,t,i,l,s,o,c,d,r,a,f,C,k;return a=new Oe({}),{c(){e=_("div"),t=_("div"),i=_("img"),s=N(),o=_("select"),c=_("option"),c.textContent="2p",d=_("option"),d.textContent="1p",r=N(),Fe(a.$$.fragment),u(i,"id","refresh"),we(i.src,l="./img/refresh.svg")||u(i,"src",l),u(i,"alt","refresh"),u(i,"draggable","false"),u(i,"class","svelte-7lxkbq"),c.__value="twoPlayer",c.value=c.__value,d.__value="onePlayer",d.value=d.__value,u(o,"name","mode"),u(o,"id","mode"),u(o,"class","svelte-7lxkbq"),n[0]===void 0&&M(()=>n[3].call(o)),u(t,"id","globalHead"),u(t,"class","svelte-7lxkbq"),u(e,"id","mainPage"),u(e,"class","svelte-7lxkbq")},m(h,P){j(h,e,P),p(e,t),p(t,i),p(t,s),p(t,o),p(o,c),p(o,d),U(o,n[0]),p(e,r),he(a,e,null),f=!0,C||(k=[B(i,"click",n[1]),B(o,"change",n[2]),B(o,"change",n[3])],C=!0)},p(h,[P]){P&1&&U(o,h[0])},i(h){f||(fe(a.$$.fragment,h),f=!0)},o(h){Ae(a.$$.fragment,h),f=!1},d(h){h&&F(e),me(a),C=!1,A(k)}}}function He(n,e,t){let i;E(n,T,c=>t(0,i=c));const l=()=>te(),s=()=>te();function o(){i=$e(this),T.set(i)}return[i,l,s,o]}class Re extends pe{constructor(e){super(),ge(this,e,He,Pe,Y,{})}}new Re({target:document.getElementById("app")});
